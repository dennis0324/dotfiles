---
- name: Check installed packages(MacOSX)
  command: brew list -1 | ConvertTo-Json
  register: mac_packages

- name: Check installed packages
  set_fact:
    uninstalled_packages: "{{ uninstalled_packages | default([]) + [ item ]}}"
  when: not ((mac_packages | dict2items | selectattr('key','in',item)) or
    (mac_packages | dict2items | selectattr('key','match',item)))
  loop: "{{ total_packages }}"

- name: uninstalled packages
  debug:
    msg: "{% if uninstalled_packages is defined %} {{ uninstalled_packages }} {% else %}no package to update{% endif %}"

- name: "Install Packages(MacOSX)"
  homebrew:
    name: "{{ item }}"
    state: present
  loop: "{{ uninstalled_packages }}"
  when: uninstalled_packages is defined
